#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <limits.h>
#include <time.h>
#include <stdbool.h>
#include <unistd.h>

void win() {
    puts("You got the hidden prize!");
    FILE *f = fopen("flag.txt", "r");
    if (f == NULL) {
        puts("Something went wrong, please open a ticket.");
        exit(1);
    }
    char s[256];
    fgets(s, sizeof(s), f);
    puts(s);
    fclose(f);
}

int main(int argc, char **argv) {
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stderr, NULL, _IONBF, 0);
    // Prepare the strings
    // Generated by AI, some I have no idea what that is.
    // Zucchini is technically a fruit I guess.
    const char* fruits[] = {
        "Apple",      // A
        "Banana",     // B
        "Cherry",     // C
        "Date",       // D
        "Elderberry", // E
        "Fig",        // F
        "Grape",      // G
        "Honeydew",   // H
        "Indian Fig", // I
        "Jackfruit",  // J
        "Kiwi",       // K
        "Lemon",      // L
        "Mango",      // M
        "Nectarine",  // N
        "Orange",     // O
        "Papaya",     // P
        "Quince",     // Q
        "Raspberry",   // R
        "Strawberry", // S
        "Tangerine",  // T
        "Ugli fruit", // U
        "Vanilla",    // V
        "Watermelon", // W
        "Xigua",      // X
        "Yellow Passion Fruit", // Y
        "Zucchini"    // Z
    };
    puts("Permutations 101");
    puts("Welcome to permutations 101 class, where we try to find all possible permutations for a sequence!");
    puts("You can select a fruit and swap it with another fruit. Do that as many times as you want.");
    puts("You can make a swap using 'swap <index> <index>'. See your current permutation using 'show'.");
    puts("After you are done, type 'finish', and we will check if your permutation is cool!");
    bool play = true;
    while (play) {
        fputs("> ", stdout);
        char cmd[32];
        scanf("%31s", cmd);
        if (strcmp(cmd, "swap") == 0) {
            int idx_a, idx_b;
            scanf("%d%d", &idx_a, &idx_b);
            const char *t = fruits[idx_a];
            fruits[idx_a] = fruits[idx_b];
            fruits[idx_b] = t;
            printf("Swapped %s with %s\n", fruits[idx_b], fruits[idx_a]);
        } else if (strcmp(cmd, "show") == 0) {
            puts("Your fruits:");
            for (int i = 0; i < (sizeof(fruits) / sizeof(const char *)); i++) {
                printf("%d --> %s\n", i, fruits[i]);
            }
        } else if (strcmp(cmd, "finish") == 0) {
            play = false;
        } else if (strlen(cmd) == 0) {}
        else {
            puts("Invalid command!");
        }
    }
    fputs("Let's check your arrangement of fruits", stdout);
    for (int i = 0; i < 3; i++) {
        sleep(1);
        putchar('.');
    }
    putchar('\n');
    puts("This is a cool arrangement!");
    return 0;
}